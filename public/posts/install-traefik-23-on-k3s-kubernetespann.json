{"date":1608580075,"cats":[0,1,3,8],"content":"<pre><code>apiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutes.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRoute\n    plural: ingressroutes\n    singular: ingressroute\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: middlewares.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: Middleware\n    plural: middlewares\n    singular: middleware\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutetcps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteTCP\n    plural: ingressroutetcps\n    singular: ingressroutetcp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressrouteudps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteUDP\n    plural: ingressrouteudps\n    singular: ingressrouteudp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsoptions.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSOption\n    plural: tlsoptions\n    singular: tlsoption\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsstores.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSStore\n    plural: tlsstores\n    singular: tlsstore\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: traefikservices.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TraefikService\n    plural: traefikservices\n    singular: traefikservice\n  scope: Namespaced\n\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: traefik-ingress-controller\n\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - services\n      - endpoints\n      - secrets\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses/status\n    verbs:\n      - update\n  - apiGroups:\n      - traefik.containo.us\n    resources:\n      - middlewares\n      - ingressroutes\n      - traefikservices\n      - ingressroutetcps\n      - ingressrouteudps\n      - tlsoptions\n      - tlsstores\n    verbs:\n      - get\n      - list\n      - watch\n\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: traefik-ingress-controller\n\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: traefik-ingress-controller\nsubjects:\n  - kind: ServiceAccount\n    name: traefik-ingress-controller\n    namespace: default\n---\napiVersion: v1\nkind: Service\nmetadata:\n name: traefik\nspec:\n ports:\n - protocol: TCP\n   name: web\n   port: 80\n - protocol: TCP\n   name: admin\n   port: 8080\n - protocol: TCP\n   name: websecure\n   port: 443\n type: LoadBalancer\n selector:\n  app: traefik\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n namespace: default\n name: traefik-ingress-controller\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: default\n  name: traefik\n  labels:\n    app: traefik\n\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: traefik\n  template:\n    metadata:\n      labels:\n        app: traefik\n    spec:\n      serviceAccountName: traefik-ingress-controller\n      containers:\n       - name: traefik\n         image: traefik\n         args:\n         \n            - --api.insecure\n            - --accesslog\n            - --entrypoints.web.Address=:80\n            - --entrypoints.websecure.Address=:443\n            - --providers.kubernetescrd\n            - --certificatesresolvers.myresolver.acme.tlschallenge\n            - --certificatesresolvers.myresolver.acme.email=xx.xx@gmail.com\n            - --certificatesresolvers.myresolver.acme.storage=acme.json\n         ports:\n            - name: web\n              containerPort: 80\n            - name: websecure\n              containerPort: 443\n            - name: admin\n              containerPort: 8080    \n---\napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: dash\nspec:\n  entryPoints:\n    - web\n  routes:\n  - match: Host(`dash.xx.xx.xx`)\n    kind: Rule\n    services:\n    - name: traefik\n      port: 8080         \n---   \n</code></pre>\n<p><br></p>\n<h3><span style=\"font-size: 18px;\">Navigate to&nbsp;dash.xx.xx.xx for dashboard</span></h3>\n<h3><img src=\"https://raw.githubusercontent.com/eramax/myBlogStorage/master/public/uploads/2020/11/16085800750pdc0.png\" style=\"width: 1102px; height: 713px;\"></h3>\n<p><br></p>\n<h3>Deploy an example app</h3>\n<p>\n    </p><pre><code>kind: Deployment\napiVersion: apps/v1\nmetadata:\n   name: whoami-app\nspec:\n   replicas: 1\n   selector:\n      matchLabels:\n         app: whoami-app\n   template:\n      metadata:\n         labels:\n            app: whoami-app\n      spec:\n         containers:\n            - name: whoami-app\n              image: containous/whoami\n---\napiVersion: v1\nkind: Service\nmetadata:\n   name: whoami-app\n   labels:\n      app: whoami-app\nspec:\n   ports:\n      - port: 80\n        name: whoami-app\n   selector:\n      app: whoami-app\n---          \napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: a1\nspec:\n  entryPoints:\n    - web\n  routes:\n  - match: Host(`a1.xx.xx.xx`)\n    kind: Rule\n    services:\n    - name: whoami-app\n      port: 80         \n---   \n</code></pre><br><p>You can reach out the app by navigate to&nbsp;a1.xx.xx.xx</p><p>Remember to update Cloudflare entries like&nbsp;</p><p><img src=\"https://raw.githubusercontent.com/eramax/myBlogStorage/master/public/uploads/2020/11/1608580075quu94.png\" style=\"width: 1097px; height: 80px;\"></p><p><br></p>","title":"Install traefik 2.3 on k3s kubernetes","slug":"install-traefik-23-on-k3s-kubernetespann"}